<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Springboot笔记(2) | K's Blog</title><meta name="description" content="Springboot笔记(2)"><meta name="author" content="PHI6kai"><meta name="copyright" content="PHI6kai"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Springboot笔记(2)"><meta name="twitter:description" content="Springboot笔记(2)"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta property="og:type" content="article"><meta property="og:title" content="Springboot笔记(2)"><meta property="og:url" content="http://yoursite.com/2020/02/06/Springboot%E7%AC%94%E8%AE%B0(2)/"><meta property="og:site_name" content="K's Blog"><meta property="og:description" content="Springboot笔记(2)"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://yoursite.com/2020/02/06/Springboot%E7%AC%94%E8%AE%B0(2)/"><link rel="next" title="Springboot笔记(1)" href="http://yoursite.com/2020/02/04/Springboot%E7%AC%94%E8%AE%B0(1)/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://PHI6kai.github.io/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: {"languages":{"author":"Author: PHI6kai","link":"Link: http://yoursite.com/2020/02/06/Springboot%E7%AC%94%E8%AE%B0(2)/","source":"Source: K's Blog","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">K's Blog</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">5</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> List</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> Movie</span></a></li></ul></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#Spring-笔记-2"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">Spring 笔记 (2)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#CRUD启航-2"><span class="toc_mobile_items-number">1.1.</span> <span class="toc_mobile_items-text">CRUD启航(2)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#配置嵌入式Servlet容器"><span class="toc_mobile_items-number">1.2.</span> <span class="toc_mobile_items-text">配置嵌入式Servlet容器</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-、如何定制和修改Servlet容器："><span class="toc_mobile_items-number">1.2.1.</span> <span class="toc_mobile_items-text">(1)、如何定制和修改Servlet容器：</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-笔记-2"><span class="toc-number">1.</span> <span class="toc-text">Spring 笔记 (2)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CRUD启航-2"><span class="toc-number">1.1.</span> <span class="toc-text">CRUD启航(2)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置嵌入式Servlet容器"><span class="toc-number">1.2.</span> <span class="toc-text">配置嵌入式Servlet容器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-、如何定制和修改Servlet容器："><span class="toc-number">1.2.1.</span> <span class="toc-text">(1)、如何定制和修改Servlet容器：</span></a></li></ol></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png)"><div id="post-info"><div id="post-title"><div class="posttitle">Springboot笔记(2)</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2020-02-06<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2020-02-11</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="Spring-笔记-2"><a href="#Spring-笔记-2" class="headerlink" title="Spring 笔记 (2)"></a>Spring 笔记 (2)</h1><h2 id="CRUD启航-2"><a href="#CRUD启航-2" class="headerlink" title="CRUD启航(2)"></a>CRUD启航(2)</h2><ol start="4">
<li>错误处理机制</li>
</ol>
<p>默认效果:<br>        （1）.如果是浏览器，返回一个默认的错误页面</p>
<pre><code>    浏览器发送请求的请求头是text.html

(2).如果是其他客户端，返回一个json数据</code></pre><p>原理：可以参照ErrorMvcAutoConfiguration:错误自动配置<br>        给容器中添加了一下配置</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">1.DefaultErrorAttributes：</span><br><span class="line"></span><br><span class="line">帮我们在页面共享信息；</span><br><span class="line">@Override</span><br><span class="line">public Map&lt;String, Object&gt; getErrorAttributes(RequestAttributes requestAttributes,    </span><br><span class="line">boolean includeStackTrace) &#123;            </span><br><span class="line">Map&lt;String, Object&gt; errorAttributes &#x3D; new LinkedHashMap&lt;String, Object&gt;();        </span><br><span class="line">errorAttributes.put(&quot;timestamp&quot;, new Date());        </span><br><span class="line">addStatus(errorAttributes, requestAttributes);        </span><br><span class="line">addErrorDetails(errorAttributes, requestAttributes, includeStackTrace);        </span><br><span class="line">addPath(errorAttributes, requestAttributes);        </span><br><span class="line">return errorAttributes;        </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">2.BasicErrorController：处理默认&#x2F;error请求</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;$&#123;server.error.path:$&#123;error.path:&#x2F;error&#125;&#125;&quot;)</span><br><span class="line">public class BasicErrorController extends AbstractErrorController &#123;</span><br><span class="line">   </span><br><span class="line">    @RequestMapping(produces &#x3D; &quot;text&#x2F;html&quot;)&#x2F;&#x2F;产生html类型的数据；浏览器发送的请求来到这个方法处理</span><br><span class="line">public ModelAndView errorHtml(HttpServletRequest request,    </span><br><span class="line">HttpServletResponse response) &#123;            </span><br><span class="line">HttpStatus status &#x3D; getStatus(request);        </span><br><span class="line">Map&lt;String, Object&gt; model &#x3D; Collections.unmodifiableMap(getErrorAttributes(        </span><br><span class="line">request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));                </span><br><span class="line">response.setStatus(status.value());        </span><br><span class="line">       </span><br><span class="line">        &#x2F;&#x2F;去哪个页面作为错误页面；包含页面地址和页面内容</span><br><span class="line">ModelAndView modelAndView &#x3D; resolveErrorView(request, response, status, model);        </span><br><span class="line">return (modelAndView &#x3D;&#x3D; null ? new ModelAndView(&quot;error&quot;, model) : modelAndView);        </span><br><span class="line">&#125;    </span><br><span class="line">@RequestMapping    </span><br><span class="line">@ResponseBody    &#x2F;&#x2F;产生json数据，其他客户端来到这个方法处理； </span><br><span class="line">public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;    </span><br><span class="line">Map&lt;String, Object&gt; body &#x3D; getErrorAttributes(request,        </span><br><span class="line">isIncludeStackTrace(request, MediaType.ALL));                </span><br><span class="line">HttpStatus status &#x3D; getStatus(request);        </span><br><span class="line">return new ResponseEntity&lt;Map&lt;String, Object&gt;&gt;(body, status);        </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">3.ErrorPageCustomizer：</span><br><span class="line">@Value(&quot;$&#123;error.path:&#x2F;error&#125;&quot;)    </span><br><span class="line">private String path &#x3D; &quot;&#x2F;error&quot;;  系统出现错误以后来到error请求进行处理；（web.xml注册的错误页</span><br><span class="line">面规则）</span><br><span class="line"></span><br><span class="line">4.DefaultErrorViewResolver：</span><br><span class="line">@Override</span><br><span class="line">public ModelAndView resolveErrorView(HttpServletRequest request, HttpStatus status,    </span><br><span class="line">Map&lt;String, Object&gt; model) &#123;            </span><br><span class="line">ModelAndView modelAndView &#x3D; resolve(String.valueOf(status), model);        </span><br><span class="line">if (modelAndView &#x3D;&#x3D; null &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;        </span><br><span class="line">modelAndView &#x3D; resolve(SERIES_VIEWS.get(status.series()), model);            </span><br><span class="line">&#125;        </span><br><span class="line">return modelAndView;        </span><br><span class="line">&#125;    </span><br><span class="line">private ModelAndView resolve(String viewName, Map&lt;String, Object&gt; model) &#123;    </span><br><span class="line">        &#x2F;&#x2F;默认SpringBoot可以去找到一个页面？  error&#x2F;404</span><br><span class="line">String errorViewName &#x3D; &quot;error&#x2F;&quot; + viewName;        </span><br><span class="line">       </span><br><span class="line">        &#x2F;&#x2F;模板引擎可以解析这个页面地址就用模板引擎解析</span><br><span class="line">TemplateAvailabilityProvider provider &#x3D; this.templateAvailabilityProviders        </span><br><span class="line">.getProvider(errorViewName, this.applicationContext);                </span><br><span class="line">if (provider !&#x3D; null) &#123;        </span><br><span class="line">            &#x2F;&#x2F;模板引擎可用的情况下返回到errorViewName指定的视图地址</span><br><span class="line">return new ModelAndView(errorViewName, model);            </span><br><span class="line">&#125;        </span><br><span class="line">        &#x2F;&#x2F;模板引擎不可用，就在静态资源文件夹下找errorViewName对应的页面   error&#x2F;404.html</span><br><span class="line">return resolveResource(errorViewName, model);        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>步骤：</p>
<p>一但系统出现4xx或者5xx之类的错误；ErrorPageCustomizer就会生效（定制错误的响应规则）；就会来到/error请求；就会被BasicErrorController处理；</p>
<p>1）响应页面；去哪个页面是由DefaultErrorViewResolver解析得到的；</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">protected ModelAndView resolveErrorView(HttpServletRequest request,</span><br><span class="line">      HttpServletResponse response, HttpStatus status, Map&lt;String, Object&gt; model) &#123;</span><br><span class="line">    &#x2F;&#x2F;所有的ErrorViewResolver得到ModelAndView</span><br><span class="line">   for (ErrorViewResolver resolver : this.errorViewResolvers) &#123;</span><br><span class="line">      ModelAndView modelAndView &#x3D; resolver.resolveErrorView(request, status, model);</span><br><span class="line">      if (modelAndView !&#x3D; null) &#123;</span><br><span class="line">         return modelAndView;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>如果定制错误响应：<br>(1).如何定制错误的页面；</li>
</ul>
<p>1）、有模板引擎的情况下；error/状态码; 【将错误页面命名为 错误状态码.html 放在模板引擎文件夹里面的<br>error文件夹下】，发生此状态码的错误就会来到 对应的页面；<br>我们可以使用4xx和5xx作为错误页面的文件名来匹配这种类型的所有错误，精确优先（优先寻找精确的状态<br>码.html）；<br>页面能获取的信息；<br>timestamp：时间戳<br>status：状态码<br>error：错误提示<br>exception：异常对象<br>message：异常消息<br>errors：JSR303数据校验的错误都在这里</p>
<p>2）、没有模板引擎（模板引擎找不到这个错误页面），静态资源文件夹下找；</p>
<p>3）、以上都没有错误页面，就是默认来到SpringBoot默认的错误提示页面；</p>
<p>(2).如何定制错误的json数据；</p>
<p>1）、自定义异常处理&amp;返回定制json数据；</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@ControllerAdvice</span><br><span class="line">public class MyExceptionHandler &#123;</span><br><span class="line">    @ResponseBody</span><br><span class="line">    @ExceptionHandler(UserNotExistException.class)</span><br><span class="line">    public Map&lt;String,Object&gt; handleException(Exception e)&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        map.put(&quot;code&quot;,&quot;user.notexist&quot;);</span><br><span class="line">        map.put(&quot;message&quot;,e.getMessage());</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;没有自适应效果...</span><br></pre></td></tr></table></figure></div>

<p>2）、转发到/error进行自适应响应效果处理</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@ExceptionHandler(UserNotExistException.class)</span><br><span class="line">    public String handleException(Exception e, HttpServletRequest request)&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">        &#x2F;&#x2F;传入我们自己的错误状态码  4xx 5xx，否则就不会进入定制错误页面的解析流程</span><br><span class="line">        &#x2F;**</span><br><span class="line">         * Integer statusCode &#x3D; (Integer) request</span><br><span class="line">         .getAttribute(&quot;javax.servlet.error.status_code&quot;);</span><br><span class="line">         *&#x2F;</span><br><span class="line">        request.setAttribute(&quot;javax.servlet.error.status_code&quot;,500);</span><br><span class="line">        map.put(&quot;code&quot;,&quot;user.notexist&quot;);</span><br><span class="line">        map.put(&quot;message&quot;,e.getMessage());</span><br><span class="line">        &#x2F;&#x2F;转发到&#x2F;error</span><br><span class="line">        return &quot;forward:&#x2F;error&quot;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></div>

<p>3).将我们的定制数据携带出去</p>
<p>出现错误以后，会来到/error请求，会被BasicErrorController处理，响应出去可以获取的数据是由getErrorAttributes得到的AbstractErrorController（ErrorController）规定的方法）；</p>
<p>1、完全来编写一个ErrorController的实现类【或者是编写AbstractErrorController的子类】，放在容器中；</p>
<p>2、页面上能用的数据，或者是json返回能用的数据都是通过errorAttributes.getErrorAttributes得到；<br>容器中DefaultErrorAttributes.getErrorAttributes()；默认进行数据处理的；自定义ErrorAttributes</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;给容器中加入我们自己定义的ErrorAttributes</span><br><span class="line">@Component</span><br><span class="line">public class MyErrorAttributes extends DefaultErrorAttributes &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Map&lt;String, Object&gt; getErrorAttributes(RequestAttributes requestAttributes,</span><br><span class="line">boolean includeStackTrace) &#123;</span><br><span class="line">        Map&lt;String, Object&gt; map &#x3D; super.getErrorAttributes(requestAttributes,</span><br><span class="line">includeStackTrace);</span><br><span class="line">        map.put(&quot;company&quot;,&quot;atguigu&quot;);</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>最终的效果：响应是自适应的，可以通过定制ErrorAttributes改变需要返回的内容.</li>
</ul>
<h2 id="配置嵌入式Servlet容器"><a href="#配置嵌入式Servlet容器" class="headerlink" title="配置嵌入式Servlet容器"></a>配置嵌入式Servlet容器</h2><ul>
<li>什么叫嵌入式Servlet容器？<br>答：我们以前写JavaWeb应用，最终会将web应用打包成war包，再在web配好tomcat容器。这里的Tomcat就是Servlet容器，最后我们在web启动Tomcat即可。</li>
</ul>
<p>区别：SpringBoot启动时无需Tomcat环境，它使用的是嵌入式的Servlet容器（默认使用Tomcat）。</p>
<p>接下来我们考虑这些问题；</p>
<h3 id="1-、如何定制和修改Servlet容器："><a href="#1-、如何定制和修改Servlet容器：" class="headerlink" title="(1)、如何定制和修改Servlet容器："></a>(1)、如何定制和修改Servlet容器：</h3><ol>
<li><p>修改和server有关的配置。（在ServerProperties（也是EmbeddedServletContainerCustomizer））</p>
<pre><code>//比如端口配置，修改
server.port=8088
//通用的Servlet容器配置
server.xxx
//Tomcat配置
server.tomcat.xxx
server.tomcat.uri-encoding=UTF-8</code></pre></li>
<li><p>编写一个<strong>EmbeddedServletContainerCustomizer</strong>:嵌入式的Servlet容器定制器，来修改Servlet容器的配置</p>
</li>
</ol>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">    public EmbeddedServletContainerCustomizer myembeddedServletContainerCustomizer()&#123;</span><br><span class="line">        return new EmbeddedServletContainerCustomizer() &#123;</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;定制嵌入式的Servlet容器相关规则</span><br><span class="line">            @Override</span><br><span class="line">            public void customize(ConfigurableEmbeddedServletContainer container) &#123;</span><br><span class="line">                container.setPort(8089);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#96;&#96;&#96; </span><br><span class="line">* 放在WebMvcConfigurerAdapter一起</span><br><span class="line"></span><br><span class="line">### (2)、如何注册Servlet三大组件</span><br><span class="line"></span><br><span class="line">**Servlet、Filter、Listener**</span><br><span class="line"></span><br><span class="line">* 如果是web项目，在main下会有以下路径：webapp&#x2F;WEB-INF&#x2F;web.xml。我们会在web.xml里面注册Servlet三大组件</span><br><span class="line"></span><br><span class="line">由于Springboot是以嵌入式的Servlet容器来启动springboot的web应用，没有web.xml这类文件结构。</span><br><span class="line"></span><br><span class="line">所以，Springboot给我们提供了以下三种方法注册Servlet组件</span><br><span class="line"></span><br><span class="line">1. ServletRegistrationBean</span><br></pre></td></tr></table></figure></div>
<p>@Bean<br>public ServletRegistrationBean myServlet(){<br>    ServletRegistrationBean registrationBean = new ServletRegistrationBean(new MyServlet(),”/myServlet”);<br>    return registrationBean;<br>    }</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2. FilterRegistrationBean</span><br></pre></td></tr></table></figure></div>
<p>@Bean<br>    public FilterRegistrationBean myFilter(){<br>        FilterRegistrationBean registrationBean = new FilterRegistrationBean();<br>        registrationBean.setFilter(new MyFilter());<br>        registrationBean.setUrlPatterns(Arrays.asList(“/hello”,”/myServlet”));<br>        return registrationBean;<br>    }</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3. ServletListenerRegistrationBean</span><br></pre></td></tr></table></figure></div>
<p>@Bean<br>    public ServletListenerRegistrationBean myListener(){<br>        ServletListenerRegistrationBean<mylistener> registrationBean = new ServletListenerRegistrationBean&lt;&gt;(new MyListener());<br>        return registrationBean;<br>    }</mylistener></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">SpringBoot帮我们自动配置SpringMVC的时候，自动注册SpringMVC的前端控制器：DispatcherServlet。</span><br><span class="line"></span><br><span class="line">DispatcherServletAutoConfiguration中是这样描述的。</span><br></pre></td></tr></table></figure></div>
<p>@Bean(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)<br>@ConditionalOnBean(value = DispatcherServlet.class, name =<br>DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)<br>public ServletRegistrationBean dispatcherServletRegistration(<br>      DispatcherServlet dispatcherServlet) {<br>   ServletRegistrationBean registration = new ServletRegistrationBean(<br>         dispatcherServlet, this.serverProperties.getServletMapping());<br>    //默认拦截： /  所有请求；包静态资源，但是不拦截jsp请求；   /*会拦截jsp<br>    //可以通过server.servletPath来修改SpringMVC前端控制器默认拦截的请求路径</p>
<p>   registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);<br>   registration.setLoadOnStartup(<br>         this.webMvcProperties.getServlet().getLoadOnStartup());<br>   if (this.multipartConfig != null) {<br>      registration.setMultipartConfig(this.multipartConfig);<br>   }<br>   return registration;<br>}</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### (3)、SpringBoot能不能支持其他的Servlet容器</span><br><span class="line"></span><br><span class="line">* 除了Tomcat，Springboot还支持**Jetty**（长连接：比如聊天系统等，需要长时间连接）、**Undertow**（不支持JSP）。</span><br><span class="line"></span><br><span class="line">在配置文件中,找到EmbeddedServletContainerCustomizer，双击后按快捷键Ctrl+H，可以看到三个不同的Servlet容器继承树。</span><br><span class="line"></span><br><span class="line">SpringBoot默认支持：</span><br><span class="line">Tomcat、Jetty、Undertow。</span><br><span class="line"></span><br><span class="line">Tomcat:</span><br></pre></td></tr></table></figure></div>
<dependency>
   <groupid>org.springframework.boot</groupid>
   <artifactid>spring‐boot‐starter‐web</artifactid>
   引入web模块默认就是使用嵌入式的Tomcat作为Servlet容器；
</dependency>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Jetty:</span><br></pre></td></tr></table></figure></div>
<!‐‐ 引入web模块 ‐‐>
<dependency>
   <groupid>org.springframework.boot</groupid>
   <artifactid>spring‐boot‐starter‐web</artifactid>
   <exclusions>
      <exclusion>
         <artifactid>spring‐boot‐starter‐tomcat</artifactid>
         <groupid>org.springframework.boot</groupid>
      </exclusion>
   </exclusions>
</dependency>
<!‐‐引入其他的Servlet容器‐‐>
<dependency>
   <artifactid>spring‐boot‐starter‐jetty</artifactid>
   <groupid>org.springframework.boot</groupid>
</dependency>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Undertow:</span><br></pre></td></tr></table></figure></div>
<!‐‐ 引入web模块 ‐‐>
<dependency>
   <groupid>org.springframework.boot</groupid>
   <artifactid>spring‐boot‐starter‐web</artifactid>
   <exclusions>
      <exclusion>
         <artifactid>spring‐boot‐starter‐tomcat</artifactid>
         <groupid>org.springframework.boot</groupid>
      </exclusion>
   </exclusions>
</dependency>
<!‐‐引入其他的Servlet容器‐‐>
<dependency>
   <artifactid>spring‐boot‐starter‐undertow</artifactid>
   <groupid>org.springframework.boot</groupid>
</dependency>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### (4)嵌入式Servlet容器自动配置原理</span><br><span class="line"></span><br><span class="line">EmbeddedServletContainerAutoConfiguration：嵌入式的Servlet容器自动配置</span><br><span class="line"></span><br><span class="line">以下是原理代码及注释</span><br></pre></td></tr></table></figure></div>
@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)
@Configuration
@ConditionalOnWebApplication
@Import(BeanPostProcessorsRegistrar.class)
//导入BeanPostProcessorsRegistrar(后置处理器的注册器)：Spring注解版；给容器中导入一些组件
//导入了EmbeddedServletContainerCustomizerBeanPostProcessor：嵌入式的Servlet容器定制器的后置处理器
//后置处理器：bean初始化前后（创建完对象，还没赋值赋值）执行初始化工作
public class EmbeddedServletContainerAutoConfiguration {

<pre><code>@Configuration</code></pre><p>@ConditionalOnClass({ Servlet.class, Tomcat.class })//判断当前是否引入了Tomcat依赖；<br>@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search =<br>SearchStrategy.CURRENT)//判断当前容器没有用户自己定义EmbeddedServletContainerFactory：嵌入式的<br>Servlet容器工厂；作用：创建嵌入式的Servlet容器</p>
<p>public static class EmbeddedTomcat {<br>@Bean<br>public TomcatEmbeddedServletContainerFactory tomcatEmbeddedServletContainerFactory()<br>{</p>
<p>return new TomcatEmbeddedServletContainerFactory();<br>}<br>}<br>    /**</p>
<ul>
<li>Nested configuration if Jetty is being used.    </li>
<li>/<br>@Configuration<br>@ConditionalOnClass({ Servlet.class, Server.class, Loader.class,<br>WebAppContext.class })<br>@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search =<br>SearchStrategy.CURRENT)</li>
</ul>
<p>public static class EmbeddedJetty {<br>@Bean<br>public JettyEmbeddedServletContainerFactory jettyEmbeddedServletContainerFactory() {<br>return new JettyEmbeddedServletContainerFactory();<br>}<br>}</p>
<p>/**    </p>
<ul>
<li>Nested configuration if Undertow is being used.    </li>
<li>/<br>@Configuration<br>@ConditionalOnClass({ Servlet.class, Undertow.class, SslClientAuthMode.class })<br>@ConditionalOnMissingBean(value = EmbeddedServletContainerFactory.class, search =SearchStrategy.CURRENT)</li>
</ul>
<p>public static class EmbeddedUndertow {<br>@Bean<br>public UndertowEmbeddedServletContainerFactory<br>undertowEmbeddedServletContainerFactory() {<br>return new UndertowEmbeddedServletContainerFactory();<br>    }<br>}</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1）、EmbeddedServletContainerFactory（嵌入式Servlet容器工厂）</span><br></pre></td></tr></table></figure></div>
<p>public interface EmbeddedServletContainerFactory {<br>   //获取嵌入式的Servlet容器<br>   EmbeddedServletContainer getEmbeddedServletContainer(<br>         ServletContextInitializer… initializers);<br>}</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2）、EmbeddedServletContainer：（嵌入式的Servlet容器）</span><br></pre></td></tr></table></figure></div>
<p>public interface EmbeddedServletContainerFactory {<br>   //获取嵌入式的Servlet容器<br>   EmbeddedServletContainer getEmbeddedServletContainer(<br>         ServletContextInitializer… initializers);<br>}</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3）、以TomcatEmbeddedServletContainerFactory为例</span><br></pre></td></tr></table></figure></div>
<p>@Override<br>public EmbeddedServletContainer getEmbeddedServletContainer(<br>      ServletContextInitializer… initializers) {<br>    //创建一个Tomcat<br>   Tomcat tomcat = new Tomcat();</p>
<pre><code>//配置Tomcat的基本环节</code></pre><p>   File baseDir = (this.baseDirectory != null ? this.baseDirectory<br>    : createTempDir(“tomcat”));<br>   tomcat.setBaseDir(baseDir.getAbsolutePath());<br>   Connector connector = new Connector(this.protocol);<br>   tomcat.getService().addConnector(connector);<br>   customizeConnector(connector);<br>   tomcat.setConnector(connector);<br>   tomcat.getHost().setAutoDeploy(false);<br>   configureEngine(tomcat.getEngine());<br>   for (Connector additionalConnector : this.additionalTomcatConnectors) {<br>      tomcat.getService().addConnector(additionalConnector);<br>   }<br>   prepareContext(tomcat.getHost(), initializers);</p>
<pre><code>//将配置好的Tomcat传入进去，返回一个EmbeddedServletContainer；并且启动Tomcat服务器</code></pre><p>   return getTomcatEmbeddedServletContainer(tomcat);<br>}</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">4）、我们对嵌入式容器的配置修改是怎么生效？</span><br><span class="line"></span><br><span class="line">&gt;ServerProperties、EmbeddedServletContainerCustomizer</span><br><span class="line"></span><br><span class="line">**EmbeddedServletContainerCustomizer**:Servlet容器定制器，帮我们修改了Servlet容器的配置</span><br><span class="line"></span><br><span class="line">原理</span><br><span class="line"></span><br><span class="line">5）、容器中导入了EmbeddedServletContainerCustomizerBeanPostProcessor</span><br></pre></td></tr></table></figure></div>
<p>//初始化之前<br>@Override<br>public Object postProcessBeforeInitialization(Object bean, String beanName)<br>      throws BeansException {<br>    //如果当前初始化的是一个ConfigurableEmbeddedServletContainer类型的组件<br>   if (bean instanceof ConfigurableEmbeddedServletContainer) {<br>       //<br>      postProcessBeforeInitialization((ConfigurableEmbeddedServletContainer) bean);<br>   }<br>   return bean;<br>}<br>private void postProcessBeforeInitialization(<br>ConfigurableEmbeddedServletContainer bean) {<br>    //获取所有的定制器，调用每一个定制器的customize方法来给Servlet容器进行属性赋值；<br>    for (EmbeddedServletContainerCustomizer customizer : getCustomizers()) {<br>        customizer.customize(bean);<br>    }<br>}<br>private Collection<embeddedservletcontainercustomizer> getCustomizers() {<br>    if (this.customizers == null) {<br>        // Look up does not include the parent context<br>        this.customizers = new ArrayList<embeddedservletcontainercustomizer>(this.beanFactory<br>            //从容器中获取所有这葛类型的组件：EmbeddedServletContainerCustomizer<br>            //定制Servlet容器，给容器中可以添加一个EmbeddedServletContainerCustomizer类型的组件<br>            .getBeansOfType(EmbeddedServletContainerCustomizer.class,<br>                            false, false)<br>            .values());<br>        Collections.sort(this.customizers, AnnotationAwareOrderComparator.INSTANCE);<br>        this.customizers = Collections.unmodifiableList(this.customizers);<br>    }<br>    return this.customizers;<br>}<br>ServerProperties也是定制器</embeddedservletcontainercustomizer></embeddedservletcontainercustomizer></p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### （5）嵌入式Servlet容器启动原理</span><br><span class="line">什么时候创建嵌入式的Servlet容器工厂？什么时候获取嵌入式的Servlet容器并启动Tomcat；</span><br><span class="line"></span><br><span class="line">获取嵌入式的Servlet容器工厂：</span><br><span class="line"></span><br><span class="line">1）、SpringBoot应用启动运行run方法</span><br><span class="line"></span><br><span class="line">2）、refreshContext(context);SpringBoot刷新IOC容器【创建IOC容器对象，并初始化容器，创建容器中的每一个组件】；如果是web应用创建**AnnotationConfigEmbeddedWebApplicationContext**，否则：</span><br><span class="line">**AnnotationConfigApplicationContext**</span><br><span class="line"></span><br><span class="line">3）、refresh(context);刷新刚才创建好的ioc容器；</span><br></pre></td></tr></table></figure></div>
<p>public void refresh() throws BeansException, IllegalStateException {<br>   synchronized (this.startupShutdownMonitor) {<br>      // Prepare this context for refreshing.<br>      prepareRefresh();<br>      // Tell the subclass to refresh the internal bean factory.<br>      ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();<br>      // Prepare the bean factory for use in this context.<br>      prepareBeanFactory(beanFactory);<br>      try {<br>         // Allows post‐processing of the bean factory in context subclasses.<br>postProcessBeanFactory(beanFactory);<br>         // Invoke factory processors registered as beans in the context.<br>         invokeBeanFactoryPostProcessors(beanFactory);<br>         // Register bean processors that intercept bean creation.<br>         registerBeanPostProcessors(beanFactory);<br>         // Initialize message source for this context.<br>         initMessageSource();<br>         // Initialize event multicaster for this context.<br>         initApplicationEventMulticaster();<br>         // Initialize other special beans in specific context subclasses.<br>         onRefresh();<br>         // Check for listener beans and register them.<br>         registerListeners();<br>         // Instantiate all remaining (non‐lazy‐init) singletons.<br>         finishBeanFactoryInitialization(beanFactory);<br>         // Last step: publish corresponding event.<br>         finishRefresh();<br>      }<br>      catch (BeansException ex) {<br>         if (logger.isWarnEnabled()) {<br>            logger.warn(“Exception encountered during context initialization ‐ “ +<br>                  “cancelling refresh attempt: “ + ex);<br>         }<br>         // Destroy already created singletons to avoid dangling resources.<br>         destroyBeans();<br>         // Reset ‘active’ flag.<br>         cancelRefresh(ex);<br>         // Propagate exception to caller.<br>         throw ex;<br>      }<br>      finally {<br>         // Reset common introspection caches in Spring’s core, since we<br>         // might not ever need metadata for singleton beans anymore…<br>         resetCommonCaches();<br>      }<br>   }<br>}</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4）、 onRefresh(); web的ioc容器重写了onRefresh方法</span><br><span class="line"></span><br><span class="line">5）、webioc容器会创建嵌入式的Servlet容器;createEmbeddedServletContainer();</span><br><span class="line"></span><br><span class="line">6）、获取嵌入式的Servlet容器工厂：</span><br><span class="line">EmbeddedServletContainerFactory containerFactory &#x3D; getEmbeddedServletContainerFactory();从ioc容器中获取EmbeddedServletContainerFactory 组件；TomcatEmbeddedServletContainerFactory创建对象，后置处理器一看是这个对象，就获取所有的定制器来先定制Servlet容器的相关配置；</span><br><span class="line"></span><br><span class="line">7）、使用容器工厂获取嵌入式的Servlet容器：this.embeddedServletContainer &#x3D; containerFactory</span><br><span class="line">.getEmbeddedServletContainer(getSelfInitializer());</span><br><span class="line"></span><br><span class="line">8）、嵌入式的Servlet容器创建对象并启动Servlet容器；</span><br><span class="line">先启动嵌入式的Servlet容器，再将ioc容器中剩下没有创建出的对象获取出来；</span><br><span class="line">IOC容器启动创建嵌入式的Servlet容器</span><br><span class="line"></span><br><span class="line">### (6)使用外置的Servlet容器</span><br><span class="line"></span><br><span class="line">嵌入式Servlet容器：应用打成可执行的jar</span><br><span class="line"></span><br><span class="line">优点：简单、便携；</span><br><span class="line"></span><br><span class="line">缺点：默认不支持JSP、优化定制比较复杂（使用定制器【ServerProperties、自定义</span><br><span class="line">EmbeddedServletContainerCustomizer】，自己编写嵌入式Servlet容器的创建工厂</span><br><span class="line">【EmbeddedServletContainerFactory】）；外置的Servlet容器：外面安装Tomcat---应用war包的方式打包；</span><br><span class="line"></span><br><span class="line">**步骤**</span><br><span class="line"></span><br><span class="line">1）、必须创建一个war项目；（利用idea创建好目录结构）</span><br><span class="line"></span><br><span class="line">2）、将嵌入式的Tomcat指定为provided；</span><br></pre></td></tr></table></figure></div>
<dependency>
   <groupid>org.springframework.boot</groupid>
   <artifactid>spring‐boot‐starter‐tomcat</artifactid>
   <scope>provided</scope>
</dependency>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">3）、必须编写一个SpringBootServletInitializer的子类，目的是调用configure方法</span><br></pre></td></tr></table></figure></div>
public class ServletInitializer extends SpringBootServletInitializer {
   @Override
   protected SpringApplicationBuilder configure(SpringApplicationBuilder application) {
       //传入SpringBoot应用的主程序
      return application.sources(SpringBoot04WebJspApplication.class);
   }
}
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">4）、启动服务器就可以使用；</span><br><span class="line"></span><br><span class="line">**原理：**</span><br><span class="line"></span><br><span class="line">jar包：执行SpringBoot主类的main方法，启动ioc容器，创建嵌入式的Servlet容器；</span><br><span class="line"></span><br><span class="line">war包：启动服务器，服务器启动SpringBoot应用【SpringBootServletInitializer】，启动ioc容器；</span><br><span class="line">servlet3.0（Spring注解版）：8.2.4 Shared libraries &#x2F; runtimes pluggability：</span><br><span class="line"></span><br><span class="line">规则：</span><br><span class="line"></span><br><span class="line">1）、服务器启动（web应用启动）会创建当前web应用里面每一个jar包里面ServletContainerInitializer实例：</span><br><span class="line"></span><br><span class="line">2）、ServletContainerInitializer的实现放在jar包的META-INF&#x2F;services文件夹下，有一个名为javax.servlet.ServletContainerInitializer的文件，内容就是ServletContainerInitializer的实现类的全类名</span><br><span class="line"></span><br><span class="line">3）、还可以使用@HandlesTypes，在应用启动的时候加载我们感兴趣的类；</span><br><span class="line"></span><br><span class="line">**流程：**</span><br><span class="line">1）、启动Tomcat</span><br><span class="line"></span><br><span class="line">2）、org\springframework\spring-web\4.3.14.RELEASE\spring-web-4.3.14.RELEASE.jar!\META-</span><br><span class="line">INF\services\javax.servlet.ServletContainerInitializer：</span><br><span class="line">Spring的web模块里面有这个文件：org.springframework.web.SpringServletContainerInitializer</span><br><span class="line"></span><br><span class="line">3）、SpringServletContainerInitializer将@HandlesTypes(WebApplicationInitializer.class)标注的所有这个类型</span><br><span class="line">的类都传入到onStartup方法的Set&gt;；为这些WebApplicationInitializer类型的类创建实例；</span><br><span class="line"></span><br><span class="line">4）、每一个WebApplicationInitializer都调用自己的onStartup；</span><br><span class="line"></span><br><span class="line">5）、相当于我们的SpringBootServletInitializer的类会被创建对象，并执行onStartup方法</span><br><span class="line"></span><br><span class="line">6）、SpringBootServletInitializer实例执行onStartup的时候会createRootApplicationContext；创建容器</span><br></pre></td></tr></table></figure></div>
protected WebApplicationContext createRootApplicationContext(
      ServletContext servletContext) {
    //1、创建SpringApplicationBuilder
   SpringApplicationBuilder builder = createSpringApplicationBuilder();
   StandardServletEnvironment environment = new StandardServletEnvironment();
   environment.initPropertySources(servletContext, null);
   builder.environment(environment);
   builder.main(getClass());
   ApplicationContext parent = getExistingRootWebApplicationContext(servletContext);
   if (parent != null) {
      this.logger.info("Root context already created (using as parent).");
      servletContext.setAttribute(
            WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, null);
      builder.initializers(new ParentContextApplicationContextInitializer(parent));
   }
   builder.initializers(
         new ServletContextApplicationContextInitializer(servletContext));
   builder.contextClass(AnnotationConfigEmbeddedWebApplicationContext.class);

<pre><code>//调用configure方法，子类重写了这个方法，将SpringBoot的主程序类传入了进来</code></pre><p>   builder = configure(builder);</p>
<pre><code>//使用builder创建一个Spring应用</code></pre><p>   SpringApplication application = builder.build();<br>   if (application.getSources().isEmpty() &amp;&amp; AnnotationUtils<br>         .findAnnotation(getClass(), Configuration.class) != null) {<br>      application.getSources().add(getClass());<br>   }<br>   Assert.state(!application.getSources().isEmpty(),<br>         “No SpringApplication sources have been defined. Either override the “<br>               + “configure method or add an @Configuration annotation”);<br>   // Ensure error pages are registered<br>   if (this.registerErrorPageFilter) {<br>      application.getSources().add(ErrorPageFilterConfiguration.class);<br>   }<br>    //启动Spring应用<br>   return run(application);<br>}</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">7）、Spring的应用就启动并且创建IOC容器</span><br></pre></td></tr></table></figure></div>
<p>public ConfigurableApplicationContext run(String… args) {<br>   StopWatch stopWatch = new StopWatch();<br>   stopWatch.start();<br>   ConfigurableApplicationContext context = null;<br>   FailureAnalyzers analyzers = null;<br>   configureHeadlessProperty();<br>   SpringApplicationRunListeners listeners = getRunListeners(args);<br>   listeners.starting();<br>   try {<br>    ApplicationArguments applicationArguments = new DefaultApplicationArguments(<br>            args);<br>      ConfigurableEnvironment environment = prepareEnvironment(listeners,<br>            applicationArguments);<br>      Banner printedBanner = printBanner(environment);<br>      context = createApplicationContext();<br>      analyzers = new FailureAnalyzers(context);<br>      prepareContext(context, environment, listeners, applicationArguments,<br>            printedBanner);</p>
<pre><code> //刷新IOC容器
refreshContext(context);
afterRefresh(context, applicationArguments);
listeners.finished(context, null);
stopWatch.stop();
if (this.logStartupInfo) {
   new StartupInfoLogger(this.mainApplicationClass)
         .logStarted(getApplicationLog(), stopWatch);
}
return context;</code></pre><p>   }<br>   catch (Throwable ex) {<br>      handleRunFailure(context, listeners, analyzers, ex);<br>      throw new IllegalStateException(ex);<br>   }<br>}</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**启动Servlet容器，再启动SpringBoot应用**</span><br><span class="line"></span><br><span class="line">## Docker</span><br><span class="line"></span><br><span class="line">### 1、简介</span><br><span class="line"></span><br><span class="line">**Docker**是一个开源的应用容器引擎：Docker支持将你安装好的软件编译成镜像，只要在Linux系统中安装了Docker，就可以使用软件的镜像文件直接进行软件的使用，运行中的这个镜像称为容器，容器启动是非常快速的。</span><br><span class="line"></span><br><span class="line">### 2、Docker的核心概念</span><br><span class="line"></span><br><span class="line">docker主机（Host）：安装了Docker程序的机器（Doc开瑞坦直接安装在OS之上）。</span><br><span class="line"></span><br><span class="line">docker客户端（Client）：连接docker主机进行操作</span><br><span class="line"></span><br><span class="line">docker仓库(Registry)：用来保存各种打包好的软件镜像；</span><br><span class="line"></span><br><span class="line">docker镜像(Images)：软件打包好的镜像；放在docker仓库中；</span><br><span class="line"></span><br><span class="line">docker容器(Container)：镜像启动后的实例称为一个容器；容器是独立运行的一个或一组应用</span><br><span class="line"></span><br><span class="line">* 使用Docker的步骤：</span><br><span class="line"></span><br><span class="line">1. 安装Docker</span><br><span class="line"></span><br><span class="line">2. 去Docker仓库找到这个软件对应的镜像；</span><br><span class="line"></span><br><span class="line">3. 使用Docker运行这个镜像，这个镜像就会生成一个Docker容器；</span><br><span class="line"></span><br><span class="line">4. 对容器的启动停止就是对软件的启动停止；</span><br><span class="line"></span><br><span class="line">### 3、安装Docker</span><br><span class="line"></span><br><span class="line">1、安装Linux虚拟机</span><br><span class="line">        （1）在我们选择此默认安装Virtual Box，随后导入centOS这个Linux系统镜像文件，使用root&#x2F;123456进入虚拟机。</span><br><span class="line"></span><br><span class="line">        （2）使用Linux客户端，连接Linux服务器进行命令操作</span><br><span class="line"></span><br><span class="line">        （3）设置虚拟机的网络，为了连接smartTTY</span><br><span class="line">                桥接网络、选好网卡、接入网线；</span><br><span class="line">                设置好后重启虚拟机网络</span><br><span class="line">                &gt;service network restart</span><br><span class="line">        (4)查看Linux的Ip地址</span><br><span class="line">                输入这个命令：ip addr</span><br><span class="line">                查看好IP地址后使用客户端连接</span><br><span class="line"></span><br><span class="line">2、Docker安装</span><br><span class="line">        （1）首先保证CentOs的系统版本高于3.10（使用uname -r查看）</span><br><span class="line">        若版本过低，则可以使用yum update进行升级</span><br><span class="line">        （2）安装Docker（使用yum install docker安装）</span><br><span class="line">        （3）启动Docker（使用systemctl start docker）</span><br><span class="line">        查看版本使用docker -v</span><br><span class="line">        （4）开启启动decker（使用systemctl enable docker）</span><br><span class="line">        （5）停止Docker（使用systemctl stop docker）</span><br><span class="line"></span><br><span class="line">3、Docker常用命令</span><br><span class="line"></span><br><span class="line">1. 镜像操作</span><br><span class="line"></span><br><span class="line">镜像：想安装的软件的打包</span><br><span class="line"></span><br><span class="line">**操作**|**命令**|**说明**</span><br><span class="line">:-|:-|:-</span><br><span class="line">检索|docker search 关键字 eg：docker search redis|我们经常去docker hub上检索镜像的详细信息，如镜像的TAG之类</span><br><span class="line">拉取|docker pull 镜像名：tag|：tag是可选的，tag表示标签，多为软件的版本，默认是latest</span><br><span class="line">列表|docker images|查看所有本地镜像</span><br><span class="line">删除|docker rmi image-id|删除指定的本地镜像</span><br><span class="line"></span><br><span class="line">感兴趣的可以去[官网](https:&#x2F;&#x2F;hub.docker.com&#x2F;)进行查看</span><br><span class="line"></span><br><span class="line">2. 容器操作</span><br><span class="line"></span><br><span class="line">软件镜像---&gt;运行镜像---&gt;产生一个容器（正在运行的软件）</span><br><span class="line"></span><br><span class="line">步骤：</span><br></pre></td></tr></table></figure></div>
<p>1、搜索镜像<br>[root@localhost ~]# docker search tomcat<br>2、拉取镜像<br>[root@localhost ~]# docker pull tomcat<br>3、根据镜像启动容器<br>docker run ‐‐name mytomcat ‐d tomcat:latest<br>4、docker ps<br>查看运行中的容器<br>5、 停止运行中的容器<br>docker stop  容器的id<br>6、查看所有的容器<br>docker ps ‐a<br>7、启动容器<br>docker start 容器id<br>8、删除一个容器<br> docker rm 容器id<br>9、启动一个做了端口映射的tomcat<br>[root@localhost ~]# docker run ‐d ‐p 8888:8080 tomcat<br>‐d：后台运行<br>‐p: 将主机的端口映射到容器的一个端口    主机端口:容器内部的端口<br>10、为了演示简单关闭了linux的防火墙<br>service firewalld status ；查看防火墙状态<br>service firewalld stop：关闭防火墙<br>11、查看容器的日志<br>docker logs container‐name/container‐id</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">更多命令参看[官方文档](https:&#x2F;&#x2F;docs.docker.com&#x2F;engine&#x2F;reference&#x2F;commandline&#x2F;docker&#x2F; &quot;官方文档&quot;)</span><br><span class="line">可以参考每一个镜像的文档</span><br><span class="line"></span><br><span class="line">3. 示例（安装MySql）</span><br></pre></td></tr></table></figure></div>
<p>docker pull mysql</p>
<p>正确的启动<br>[root@localhost ~]# docker run ‐‐name mysql01 ‐e MYSQL_ROOT_PASSWORD=123456 ‐d mysql<br>b874c56bec49fb43024b3805ab51e9097da779f2f572c22c695305dedd684c5f<br>[root@localhost ~]# docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS<br>         PORTS           NAMES<br>b874c56bec49             mysql               “docker‐entrypointsh”   4 seconds ago       Up 3<br>seconds        3306/tcp            mysql01</p>
<p>做了端口映射</p>
<p>[root@localhost ~]# docker run ‐p 3306:3306 ‐‐name mysql02 ‐e MYSQL_ROOT_PASSWORD=123456 ‐d<br>mysql<br>ad10e4bc5c6a0f61cbad43898de71d366117d120e39db651844c0e73863b9434<br>[root@localhost ~]# docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS<br>           PORTS                    NAMES<br>ad10e4bc5c6a        mysql               “docker‐entrypoint.sh”   4 seconds ago       Up 2<br>seconds        0.0.0.0:3306‐&gt;3306/tcp   mysql02</p>
<p>几个其他的高级操作</p>
<p>docker run ‐‐name mysql03 ‐v /conf/mysql:/etc/mysql/conf.d ‐e MYSQL_ROOT_PASSWORD=my‐secret‐pw<br>‐d mysql:tag<br>把主机的/conf/mysql文件夹挂载到 mysqldocker容器的/etc/mysql/conf.d文件夹里面<br>改mysql的配置文件就只需要把mysql配置文件放在自定义的文件夹下（/conf/mysql）<br>docker run ‐‐name some‐mysql ‐e MYSQL_ROOT_PASSWORD=my‐secret‐pw ‐d mysql:tag ‐‐character‐set‐<br>server=utf8mb4 ‐‐collation‐server=utf8mb4_unicode_ci<br>指定mysql的一些配置参数</p>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**错误解决提示**</span><br><span class="line">1.关于Job for docker.service failed because the control process exited with error。</span><br><span class="line"></span><br><span class="line">解决方法是删除以前安装的docker，随后安装新的，如果你用的也是CentOS，请参考以下[网站](https:&#x2F;&#x2F;www.cnblogs.com&#x2F;qgc1995&#x2F;archive&#x2F;2018&#x2F;08&#x2F;29&#x2F;9553572.html)</span><br><span class="line"></span><br><span class="line">2.关于Cannot connect to the Docker daemon at unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock. Is the docker daemon running?</span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line"></span><br><span class="line">&gt;systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">&gt;systemctl restart docker.service</span><br><span class="line"></span><br><span class="line">## SpringBoot与数据访问</span><br><span class="line"></span><br><span class="line">**JDBC、MyBatis、Spring Data JPA**</span><br><span class="line"></span><br><span class="line">无论是SQL，还是NOSQL，SpringBoot默认采用整合SpringData的方式进行统一处理，添加大量自动配置。引入各种XXXTemplate，XXXRepository来简化我们对数据层访问的操作。对我们来说只需要进行简单的设置即可。</span><br><span class="line"></span><br><span class="line">### JDBC</span><br></pre></td></tr></table></figure></div>
<dependency>
<groupid>org.springframework.boot</groupid>            
<artifactid>spring‐boot‐starter‐jdbc</artifactid>            
</dependency>        
<dependency>        
<groupid>mysql</groupid>            
<artifactid>mysql‐connector‐java</artifactid>            
<scope>runtime</scope>            
</dependency> 
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">application.yml</span><br></pre></td></tr></table></figure></div>
spring:
  datasource:
    username: root
    password: 123456
    url: jdbc:mysql://192.168.15.22:3306/jdbc
    driver‐class‐name: com.mysql.jdbc.Driver
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">效果：</span><br><span class="line"></span><br><span class="line">默认是用org.apache.tomcat.jdbc.pool.DataSource作为数据源；</span><br><span class="line"></span><br><span class="line">数据源的相关配置都在DataSourceProperties里面；</span><br><span class="line"></span><br><span class="line">自动配置原理：</span><br><span class="line"></span><br><span class="line">org.springframework.boot.autoconfigure.jdbc：</span><br><span class="line"></span><br><span class="line">1. 参考DataSourceConfiguration，根据配置创建数据源，默认使用Tomcat连接池；可以使用spring.datasource.type指定自定义的数据源类型；</span><br><span class="line"></span><br><span class="line">2. SpringBoot默认可以支持；</span><br><span class="line">&gt;org.apache.tomcat.jdbc.pool.DataSource、HikariDataSource、BasicDataSource、</span><br><span class="line"></span><br><span class="line">3. 自定义数据源类型</span><br></pre></td></tr></table></figure></div>
@ConditionalOnMissingBean(DataSource.class)
@ConditionalOnProperty(name = "spring.datasource.type")
static class Generic {
    @Bean
   public DataSource dataSource(DataSourceProperties properties) {
       //使用DataSourceBuilder创建数据源，利用反射创建响应type的数据源，并且绑定相关属性
      return properties.initializeDataSourceBuilder().build();
   }
}
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">Code</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. DataSourceInitializer：ApplicationListener</span><br><span class="line"></span><br><span class="line">作用：</span><br><span class="line"></span><br><span class="line">1）、runSchemaScripts();运行建表语句；</span><br><span class="line"></span><br><span class="line">2）、runDataScripts();运行插入数据的sql语句；</span><br><span class="line">默认只需要将文件命名为：</span><br></pre></td></tr></table></figure></div>
schema‐*.sql、data‐*.sql
默认规则：schema.sql，schema‐all.sql；
可以使用  
schema:    
      ‐ classpath:department.sql
      指定位置
```

<ol start="5">
<li>操作数据库：自动配置了JdbcTemplate操作数据库</li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">PHI6kai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2020/02/06/Springboot%E7%AC%94%E8%AE%B0(2)/">http://yoursite.com/2020/02/06/Springboot%E7%AC%94%E8%AE%B0(2)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> Donate<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="/img" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2020/02/04/Springboot%E7%AC%94%E8%AE%B0(1)/"><img class="next_cover lazyload" data-src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/top_img/default.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>Springboot笔记(1)</span></div></a></div></nav></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By PHI6kai</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">简</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/activate-power-mode/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true; 
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>